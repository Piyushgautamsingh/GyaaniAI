http_port 3128

# ACLs to allow specific traffic
acl local_services dstdomain .qdrant .ollama  # Allow traffic to qdrant and ollama
acl ollama_registry dstdomain .registry.ollama.ai  # Allow traffic to Ollama registry
acl cloudflare_r2 dstdomain .r2.cloudflarestorage.com  # Allow traffic to Cloudflare R2 storage
acl allowed_ports port 80 443 6333 11434     # Allow HTTP, HTTPS, Qdrant, and Ollama ports

# Allow traffic to local services, Ollama registry, and Cloudflare R2 storage
http_access allow local_services allowed_ports
http_access allow ollama_registry allowed_ports
http_access allow cloudflare_r2 allowed_ports

# Deny all other traffic by default
http_access deny all

# Logging
access_log /var/log/squid/access.log
cache_log /var/log/squid/cache.log